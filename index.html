<!DOCTYPE HTML>
<html>
    <head>
        <title>Drag and Drop in Firefox 3.5</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        <meta http-equiv="Content-Language" content="en-us" />
        <link rel="stylesheet" type="text/css" href="css/index.css" />
        <script type="text/javascript" src="js/jquery-1.3.2.js"></script>
        <script type="text/javascript" src="js/jquery-ui-1.7.2.custom.min.js"></script>
        <script type="text/javascript" src="js/global.js"></script>
    <style>div { width: 500px }</style>
    </head>
    
    <body>

        <div id="toc">
            <h1>
                Drag and Drop in 
                <img id="logo" src="img/firefox-64.png" width="32" height="32" /> 
                Firefox 3.5
            </h1>
            <p>
                by l.m.orchard
                &lt;<a href="mailto:lorchard@mozilla.com">lorchard@mozilla.com</a>&gt;
                <a href="http://decafbad.com">0xDECAFBAD</a>
            </p>
            <ul class="sections">
                <li class="template"><a href="#">...</a></li>
            </ul>
        </div>

        <!-- start copying below here for a blog entry -->

        <div id="introduction">
            <h2>Introduction</h2>
            <p>
                Drag and drop is one of the most fundamental interactions
                afforded by graphical user interfaces.  In one gesture, it
                allows users to pair the selection of an object with the
                execution of an action, often including a second object in the
                operation.  It's a simple yet powerful UI concept used to
                support copying, list reordering, deletion (ala the Trash / Recycle Bin),
                and even the creation of link relationships.
            </p><p>
                Since it's so fundamental, offering drag and drop in web
                applications has been a no-brainer ever since browsers first
                offered mouse events in DHTML.  But, although
                <code>mousedown</code>, <code>mousemove</code>, and
                <code>mouseup</code> made it possible, the implementation has been
                limited to the bounds of the browser window.  Additionally,
                since these events refer only to the object being dragged,
                there's a challenge to find the subject of the drop when
                the interaction is completed.
            </p><p>
                Of course, that doesn't prevent most modern JavaScript
                frameworks from abstracting away most of the problems and
                throwing in some flourishes while they're at it.  But, wouldn't
                it be nice if browsers offered first-class support for drag and
                drop, and maybe even extended it beyond the window sandbox?
            </p><p>
                As it turns out, this very wish is answered by the HTML 5 specification 
                <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/editing.html#dnd">section on new drag-and-drop events</a>, and 
                <a href="https://developer.mozilla.org/En/DragDrop/Drag_and_Drop">Firefox 3.5 includes an implementation</a> of those events.
            </p><p>
                If you want to jump straight to the code, I've put together 
                <a href="http://decafbad.com/2009/07/drag-and-drop/api-demos.html">some simple demos</a> 
                of the new events.  
            </p><p>
                I've even scratched an itch of my own and
                built <a href="http://decafbad.com/2009/07/drag-and-drop/outline.html">the beginnings of an outline editor</a>,
                where every draggable element is also a drop targetâ€”of which
                there could be dozens to hundreds in a complex document, something
                that gave me some minor hair-tearing moments at times in the past
                while trying to make do with plain old mouse events.
            </p>
        </div>

        <div id="events">
            <h2>The New Drag and Drop Events</h2>
            <p>So, with no further ado, here are the new drag and drop events:</p>
            <dl>
                <dt><code>dragstart</code></dt>
                <dd>
                    A drag has been initiated, with the dragged element as the
                    event target.
                </dd>
                <dt><code>drag</code></dt>
                <dd>
                    The mouse has moved, with the dragged element as the event target.
                </dd>
                <dt><code>dragenter</code></dt>
                <dd>
                    The dragged element has been moved into a drop listener,
                    with the drop listener element as the event target.
                </dd>
                <dt><code>dragover</code></dt>
                <dd>
                    The dragged element has been moved over a drop listener,
                    with the drop listener element as the event target.  Since
                    the default behavior is to cancel drops, returning
                    <code>false</code> or calling <code>preventDefault()</code> in
                    the event handler indicates that a drop is allowed here.
                </dd>
                <dt><code>dragleave</code></dt>
                <dd>
                    The dragged element has been moved out of a drop listener,
                    with the drop listener element as the event target.
                </dd>
                <dt><code>drop</code></dt>
                <dd>
                    The dragged element has been successfully dropped on a drop
                    listener, with the drop listener element as the event
                    target.
                </dd>
                <dt><code>dragend</code></dt>
                <dd>
                    A drag has been ended, successfully or not, with the
                    dragged element as the event target.
                </dd>
            </dl>
            <p>
                Like mouse events and others, listeners can be attached to
                elements for them with <code>addEventListener()</code> 
                directly or via your favorite JS library.  
            </p><p>
                Consider the following example using jQuery, also available as
                a demo:
            </p>
            <pre lang="javascript">
    &lt;div id="newschool"&gt;
        &lt;div class="dragme"&gt;Drag me!&lt;/div&gt;
        &lt;div class="drophere"&gt;Drop here!&lt;/div&gt;
    &lt;/div&gt;

    &lt;script type="text/javascript"&gt;
        $(document).ready(function() {
            $('#newschool .dragme')
                .attr('draggable', 'true')
                .bind('dragstart', function(ev) {
                    var dt = ev.originalEvent.dataTransfer;
                    dt.setData("Text", "Dropped in zone!");
                    return true;
                })
                .bind('dragend', function(ev) {
                    return false;
                });
            $('#newschool .drophere')
                .bind('dragenter', function(ev) {
                    $(ev.target).addClass('dragover');
                    return false;
                })
                .bind('dragleave', function(ev) {
                    $(ev.target).removeClass('dragover');
                    return false;
                })
                .bind('dragover', function(ev) {
                    return false;
                })
                .bind('drop', function(ev) {
                    var dt = ev.originalEvent.dataTransfer;
                    alert(dt.getData('Text'));
                    return false;
                });
        });
    &lt;/script&gt;
            </pre>
                    
                <p>
            </p><p>
        </div>

        <div id="datatransfer">
            <h2>Using dataTransfer</h2>
        </div>

        <div id="dragfeedback">
            <h2>Using Drag Feedback Images</h2>
        </div>

        <div id="dragfeedback">
            <h2>Using Drop Effects</h2>
        </div>

    </body>
</html>
